<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jamia Masjid Usman-e-Ghani - Namaz Timing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <style>
        body {
            font-family: "Inter", sans-serif;
        }

        .nav-link.active {
            background-color: #c2c7c2;
            color: #065f46;
            font-weight: 600;
        }

        /* This is the new CSS rule for the dropdown links */
        .dropdown-item {
            cursor: pointer;
            padding: 0.5rem 1rem;
            display: block;
            font-size: 0.875rem;
            color: #4b5563;
            transition: background-color 0.2s, color 0.2s;
            border-bottom: 1px solid #e5e7eb;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background-color: #d1fae5;
            color: #047857;
        }

        .current-prayer-highlight {
            background-color: #ffd700 !important;
            border-left: 4px solid #059669;
            font-weight: bold;
        }

        .next-prayer-highlight {
            background-color: #e6fffa;
        }

        @keyframes blink {
            0% {
                background-color: #1cf36b;
                /* A bright neon green */
            }

            50% {
                background-color: #d5e7dc;
                /* A very light, pale green */
            }

            100% {
                background-color: #47c776;
            }
        }

        .animate-blink {
            animation: blink 2s infinite;
        }
    </style>
</head>

<body class="bg-gray-50">
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="text-xl font-bold text-green-700">
                    Jamia Masjid Usman-e-Ghani
                </div>
                <div class="hidden md:flex items-center space-x-2">
                    <a href="index.html"
                        class="nav-link px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200 text-gray-700 hover:bg-green-100 hover:text-green-800">Home</a>
                    <a href="namaz-timing.html"
                        class="nav-link px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200 text-gray-700 hover:bg-green-100 hover:text-green-800">Namaz
                        Timing</a>
                    <a href="members.html"
                        class="nav-link px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200 text-gray-700 hover:bg-green-100 hover:text-green-800">Members</a>
                    <a href="about.html"
                        class="nav-link px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200 text-gray-700 hover:bg-green-100 hover:text-green-800">About</a>
                    <div class="relative group">
                        <button
                            class="nav-link px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200 text-gray-700 hover:bg-green-100 hover:text-green-800">Media</button>
                        <div class="absolute hidden group-hover:block w-48 bg-white shadow-lg rounded-md mt-2 py-1 z-10">
                            <a href="gallery.html" class="dropdown-item">Gallery</a>
                            <a href="tilawat.html" class="dropdown-item active">Tilawat</a>
                            <a href="video.html" class="dropdown-item">Video</a>
                        </div>
                    </div>
                    <a href="donation.html"
                        class="nav-link px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200 text-gray-700 hover:bg-green-100 hover:text-green-800 animate-blink">Donation</a>
                    <a href="contact.html"
                        class="nav-link px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200 text-gray-700 hover:bg-green-100 hover:text-green-800">Contact
                        Us</a>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-gray-700 hover:text-green-700 focus:outline-none">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 6h16M4 12h16m-7 6h7" />
                        </svg>
                    </button>
                </div>
            </div>
            <div id="mobile-menu" class="hidden md:hidden pb-4">
                <a href="index.html"
                    class="block nav-link px-4 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-green-100 hover:text-green-800">Home</a>
                <a href="namaz-timing.html"
                    class="block nav-link px-4 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-green-100 hover:text-green-800">Namaz
                    Timing</a>
                <a href="members.html"
                    class="block nav-link px-4 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-green-100 hover:text-green-800">Members</a>
                <a href="about.html"
                    class="block nav-link px-4 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-green-100 hover:text-green-800">About</a>
                <div class="relative">
                    <button id="media-mobile-button"
                        class="block w-full text-left nav-link px-4 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-green-100 hover:text-green-800">Media</button>
                    <div id="media-mobile-dropdown" class="hidden pl-4">
                        <a href="gallery.html" class="dropdown-item">Gallery</a>
                        <a href="tilawat.html" class="dropdown-item active">Tilawat</a>
                        <a href="video.html" class="dropdown-item">Video</a>
                    </div>
                </div>
                <a href="donation.html"
                    class="block nav-link px-4 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-green-100 hover:text-green-800 animate-blink">Donation</a>
                <a href="contact.html"
                    class="block nav-link px-4 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-green-100 hover:text-green-800">Contact
                    Us</a>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="text-center mb-8 p-6 bg-white rounded-xl shadow-lg max-w-2xl mx-auto">
            <h2 class="text-4xl font-bold text-gray-800" id="current-time">
                --:--:-- --
            </h2>
            <div id="next-prayer-info" class="mt-4">
                <p class="text-lg font-semibold text-green-800">
                    Loading next prayer...
                </p>
                <p id="countdown-timer" class="text-2xl font-bold text-gray-700"></p>
            </div>
            <div id="morning-dua"
                class="hidden mt-4 p-4 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 rounded-md">
                <p class="font-bold">Sunrise Dua:</p>
                <p class="italic">
                    "Alhamdu lillahil-ladhi ahyana ba'da ma amatana wa ilayhin-nushur"
                </p>
            </div>
        </div>

        <div class="space-y-8">
            <div class="text-center">
                <h1 class="text-4xl font-bold text-green-800">Namaz Timings</h1>
                <p id="namaz-date" class="text-gray-600 mt-2">Loading date...</p>
            </div>
            <div id="namaz-loader" class="flex justify-center items-center h-full">
                <div class="w-16 h-16 border-4 border-dashed rounded-full animate-spin border-green-600"></div>
            </div>
            <p id="namaz-error" class="hidden text-center text-red-500 bg-red-100 p-4 rounded-lg"></p>
            <div id="namaz-card" class="hidden bg-white rounded-xl shadow-lg overflow-hidden p-6 md:p-8 max-w-2xl mx-auto">
                <div id="namaz-timings-container" class="space-y-4"></div>
                <div class="mt-6 text-center text-sm text-gray-500">
                    <p>Calculation Method: University of Islamic Sciences, Karachi</p>
                    <p>Fiqh: Hanafi</p>
                    <p>Coordinates: 24.8667° N, 67.05° E</p>
                </div>
            </div>

            <div class="mt-12 max-w-4xl mx-auto">
                <h2 class="text-3xl font-bold text-green-800 text-center mb-6">
                    Annual Fixed Jamaat Timetable
                </h2>
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-gray-600">
                            <thead class="text-xs text-green-800 uppercase bg-green-100">
                                <tr>
                                    <th scope="col" class="px-6 py-3">Month</th>
                                    <th scope="col" class="px-6 py-3 text-center">Fajr</th>
                                    <th scope="col" class="px-6 py-3 text-center">Asr</th>
                                    <th scope="col" class="px-6 py-3 text-center">Isha</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-white border-b">
                                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                                        January
                                    </th>
                                    <td class="px-6 py-4 text-center">6:30 AM</td>
                                    <td class="px-6 py-4 text-center">4:45 PM</td>
                                    <td class="px-6 py-4 text-center">8:00 PM</td>
                                </tr>
                                <tr class="bg-green-50 border-b">
                                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                                        February
                                    </th>
                                    <td class="px-6 py-4 text-center">6:15 AM</td>
                                    <td class="px-6 py-4 text-center">5:00 PM</td>
                                    <td class="px-6 py-4 text-center">8:00 PM</td>
                                </tr>
                                <tr class="bg-white border-b">
                                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                                        March
                                    </th>
                                    <td class="px-6 py-4 text-center">6:00 AM</td>
                                    <td class="px-6 py-4 text-center">5:15 PM</td>
                                    <td class="px-6 py-4 text-center">8:15 PM</td>
                                </tr>
                                <tr class="bg-green-50 border-b">
                                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                                        April
                                    </th>
                                    <td class="px-6 py-4 text-center">5:45 AM</td>
                                    <td class="px-6 py-4 text-center">5:30 PM</td>
                                    <td class="px-6 py-4 text-center">8:30 PM</td>
                                </tr>
                                <tr class="bg-white border-b">
                                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                                        May
                                    </th>
                                    <td class="px-6 py-4 text-center">5:30 AM</td>
                                    <td class="px-6 py-4 text-center">5:45 PM</td>
                                    <td class="px-6 py-4 text-center">8:45 PM</td>
                                </tr>
                                <tr class="bg-green-50 border-b">
                                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                                        June
                                    </th>
                                    <td class="px-6 py-4 text-center">5:30 AM</td>
                                    <td class="px-6 py-4 text-center">5:45 PM</td>
                                    <td class="px-6 py-4 text-center">9:00 PM</td>
                                </tr>
                                <tr class="bg-white border-b">
                                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                                        July
                                    </th>
                                    <td class="px-6 py-4 text-center">5:30 AM</td>
                                    <td class="px-6 py-4 text-center">5:45 PM</td>
                                    <td class="px-6 py-4 text-center">9:00 PM</td>
                                </tr>
                                <tr class="bg-green-50 border-b">
                                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                                        August
                                    </th>
                                    <td class="px-6 py-4 text-center">5:45 AM</td>
                                    <td class="px-6 py-4 text-center">5:30 PM</td>
                                    <td class="px-6 py-4 text-center">8:45 PM</td>
                                </tr>
                                <tr class="bg-white border-b">
                                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                                        September
                                    </th>
                                    <td class="px-6 py-4 text-center">6:00 AM</td>
                                    <td class="px-6 py-4 text-center">5:15 PM</td>
                                    <td class="px-6 py-4 text-center">8:15 PM</td>
                                </tr>
                                <tr class="bg-green-50 border-b">
                                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                                        October
                                    </th>
                                    <td class="px-6 py-4 text-center">6:15 AM</td>
                                    <td class="px-6 py-4 text-center">5:00 PM</td>
                                    <td class="px-6 py-4 text-center">8:00 PM</td>
                                </tr>
                                <tr class="bg-white border-b">
                                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                                        November
                                    </th>
                                    <td class="px-6 py-4 text-center">6:30 AM</td>
                                    <td class="px-6 py-4 text-center">4:45 PM</td>
                                    <td class="px-6 py-4 text-center">7:45 PM</td>
                                </tr>
                                <tr class="bg-green-50">
                                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                                        December
                                    </th>
                                    <td class="px-6 py-4 text-center">6:45 AM</td>
                                    <td class="px-6 py-4 text-center">4:30 PM</td>
                                    <td class="px-6 py-4 text-center">7:45 PM</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="p-4 text-center text-sm text-gray-500 bg-gray-50">
                        <p>
                            <strong>Note:</strong> Dhuhr (1:30 PM), Jummah (1:50 PM), and
                            Maghrib (5 mins after Adhan) times are fixed year-round. This
                            table shows monthly changes for other prayers.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="audio-permission-banner"
        class="fixed bottom-0 left-0 right-0 bg-blue-100 border-t border-blue-200 p-3 text-center text-blue-800 z-50 flex justify-between items-center">
        <span>Click anywhere on the page to enable Azan & Aqamat audio
            notifications.</span>
        <button id="close-banner-btn" class="text-blue-800 font-bold text-xl px-2">
            &times;
        </button>
    </div>

    <footer class="bg-gray-800 text-white mt-12">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6 text-center">
            <p>
                © <span id="year"></span> Jamia Masjid Usman-e-Ghani. All Rights
                Reserved.
            </p>
            <p class="text-sm text-gray-400 mt-1">
                ST-11, Sector 5-A/1, North Karachi, Karachi
            </p>
        </div>
    </footer>

    <audio id="azan-audio" preload="auto" src="azan.aac"></audio>
    <audio id="iqamah-audio" preload="auto" src="Iqamat.mp3"></audio>

    <script>
        let clockInterval = null;
        let prayerTimesData = {};
        let jamaatTimesData = {};
        let playedStatus = {};
        let allEvents = []; // Will hold all events (Adhan, Jamaat) sorted by time

        document.addEventListener("DOMContentLoaded", () => {
            const mobileMenuButton = document.getElementById("mobile-menu-button");
            const mobileMenu = document.getElementById("mobile-menu");
            mobileMenuButton.addEventListener("click", () => {
                mobileMenu.classList.toggle("hidden");
            });

            // New logic for mobile dropdown
            const mediaMobileButton = document.getElementById("media-mobile-button");
            const mediaMobileDropdown = document.getElementById("media-mobile-dropdown");
            mediaMobileButton.addEventListener("click", () => {
                mediaMobileDropdown.classList.toggle("hidden");
            });

            document.getElementById("year").textContent = new Date().getFullYear();
            fetchNamazTimings();

            const audioBanner = document.getElementById("audio-permission-banner");
            const closeBannerBtn = document.getElementById("close-banner-btn");

            function enableAudio() {
                const azanAudio = document.getElementById("azan-audio");
                const iqamahAudio = document.getElementById("iqamah-audio");

                // Unlock Azan audio
                azanAudio.muted = true;
                azanAudio.play().catch(() => {});
                azanAudio.pause();
                azanAudio.currentTime = 0;
                azanAudio.muted = false;

                // Unlock Iqamah audio as well
                iqamahAudio.muted = true;
                iqamahAudio.play().catch(() => {});
                iqamahAudio.pause();
                iqamahAudio.currentTime = 0;
                iqamahAudio.muted = false;

                audioBanner.style.display = "none";
                document.body.removeEventListener("click", enableAudio);
            }

            document.body.addEventListener("click", enableAudio, {
                once: true
            });
            closeBannerBtn.addEventListener("click", (e) => {
                e.stopPropagation();
                audioBanner.style.display = "none";
            });
        });

        // Helper function to add minutes to a time string (HH:mm)
        function addMinutes(timeStr, minsToAdd) {
            const [hours, minutes] = timeStr.split(":").map(Number);
            const date = new Date();
            date.setHours(hours, minutes + minsToAdd, 0, 0);
            const newHours = String(date.getHours()).padStart(2, "0");
            const newMinutes = String(date.getMinutes()).padStart(2, "0");
            return `${newHours}:${newMinutes}`;
        }

        // Helper function to get seconds from a time string
        function timeToSeconds(time) {
            if (!time) return 0;
            const [hours, minutes] = time.split(":").map(Number);
            return hours * 3600 + minutes * 60;
        }

        function setupEventsAndClock() {
            allEvents = [];
            const prayers = ["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"];

            // Add all events (Adhan, Jamaat) to a single array
            prayers.forEach((name) => {
                if (prayerTimesData[name]) {
                    allEvents.push({
                        name: name,
                        time: prayerTimesData[name],
                        type: "Adhan",
                    });
                }
                if (jamaatTimesData[name]) {
                    allEvents.push({
                        name: name,
                        time: jamaatTimesData[name],
                        type: "Jamaat",
                    });
                }
            });

            // Add Sunrise and Jummah as special events
            if (prayerTimesData.Sunrise) {
                allEvents.push({
                    name: "Sunrise",
                    time: prayerTimesData.Sunrise,
                    type: "Sunrise",
                });
            }
            if (jamaatTimesData.Jummah) {
                allEvents.push({
                    name: "Jummah",
                    time: jamaatTimesData.Jummah,
                    type: "Jamaat",
                });
            }

            // Sort all events by time
            allEvents.sort((a, b) => timeToSeconds(a.time) - timeToSeconds(b.time));

            runClockAndChecks();
        }

        function runClockAndChecks() {
            if (clockInterval) clearInterval(clockInterval);

            clockInterval = setInterval(() => {
                const now = new Date();
                const formattedTime = now.toLocaleTimeString("en-US");
                document.getElementById("current-time").textContent = formattedTime;
                const nowInSeconds = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();

                // Logic for highlighting the current and next prayer periods
                const prayerOrderForHighlight = ["Fajr", "Sunrise", "Dhuhr", "Asr", "Maghrib", "Isha"];
                let nextPrayerNameForHighlight = "Fajr";
                let currentPrayerNameForHighlight = "";
                let foundNextHighlight = false;

                document.querySelectorAll("[id^=prayer-row-]").forEach((row) =>
                    row.classList.remove("current-prayer-highlight", "next-prayer-highlight")
                );

                for (let i = 0; i < prayerOrderForHighlight.length; i++) {
                    const prayerName = prayerOrderForHighlight[i];
                    const prayerTime = prayerTimesData[prayerName];
                    if (prayerTime && timeToSeconds(prayerTime) > nowInSeconds) {
                        nextPrayerNameForHighlight = prayerName;
                        foundNextHighlight = true;
                        if (i > 0) {
                            currentPrayerNameForHighlight = prayerOrderForHighlight[i - 1];
                        } else {
                            // If Fajr is the next prayer, Isha is the current one
                            currentPrayerNameForHighlight = "Isha";
                        }
                        break;
                    }
                }
                // Handle the case where the current time is after Isha
                if (!foundNextHighlight) {
                    currentPrayerNameForHighlight = "Isha";
                }

                if (currentPrayerNameForHighlight) {
                    document.getElementById(`prayer-row-${currentPrayerNameForHighlight}`)
                        ?.classList.add("current-prayer-highlight");
                }
                if (foundNextHighlight) {
                    document.getElementById(`prayer-row-${nextPrayerNameForHighlight}`)
                        ?.classList.add("next-prayer-highlight");
                }

                // Logic for countdown and audio alerts based on the combined events list
                let nextEvent = null;
                let foundNextEvent = false;

                for (const event of allEvents) {
                    if (timeToSeconds(event.time) > nowInSeconds) {
                        nextEvent = event;
                        foundNextEvent = true;
                        break;
                    }
                }

                if (!foundNextEvent) {
                    // After the last event of the day, the next event is Fajr Adhan of the next day
                    nextEvent = allEvents.find(event => event.name === 'Fajr' && event.type === 'Adhan');
                }

                if (nextEvent) {
                    let timeToNextEventInSeconds;
                    if (foundNextEvent) {
                        timeToNextEventInSeconds = timeToSeconds(nextEvent.time) - nowInSeconds;
                    } else {
                        // Calculate time until next day's Fajr
                        timeToNextEventInSeconds = 24 * 3600 - nowInSeconds + timeToSeconds(nextEvent.time);
                    }

                    const hours = Math.floor(timeToNextEventInSeconds / 3600);
                    const minutes = Math.floor((timeToNextEventInSeconds % 3600) / 60);
                    const seconds = timeToNextEventInSeconds % 60;

                    const eventDisplayName = nextEvent.type === "Jamaat" ? `${nextEvent.name} Jamaat` : `${nextEvent.name}`;
                    document.querySelector("#next-prayer-info p:first-child").textContent = `Time until ${eventDisplayName}:`;
                    document.getElementById("countdown-timer").textContent = `${String(hours).padStart(2, "0")}h ${String(minutes).padStart(2, "0")}m ${String(seconds).padStart(2, "0")}s`;

                    // Audio & Dua Trigger Logic
                    if (timeToNextEventInSeconds <= 1) {
                        const eventKey = `${nextEvent.name}-${nextEvent.type}`;
                        if (nextEvent.type === "Adhan" && !playedStatus[eventKey]) {
                            console.log(`Time for ${nextEvent.name} Adhan! Playing Azan.`);
                            document.getElementById("azan-audio").play().catch(e => console.error("Azan audio play failed:", e));
                            playedStatus[eventKey] = true;
                        } else if (nextEvent.type === "Jamaat" && !playedStatus[eventKey]) {
                            console.log(`Time for ${nextEvent.name} Jamaat! Playing Iqamah.`);
                            document.getElementById("iqamah-audio").play().catch(e => console.error("Iqamah audio play failed:", e));
                            playedStatus[eventKey] = true;
                        } else if (nextEvent.type === "Sunrise" && !playedStatus[eventKey]) {
                            console.log("Time for Sunrise Dua.");
                            document.getElementById("morning-dua").classList.remove("hidden");
                            setTimeout(() => document.getElementById("morning-dua").classList.add("hidden"), 5 * 60 * 1000);
                            playedStatus[eventKey] = true;
                            // Reset played status for the next day after Isha
                            if (nextEvent.name === "Isha" && nextEvent.type === "Jamaat") {
                                setTimeout(() => {
                                    Object.keys(playedStatus).forEach(key => (playedStatus[key] = false));
                                    console.log("All prayer statuses reset for the next day.");
                                }, 5000);
                            }
                        }
                    }
                }
            }, 1000);
        }

        // Function to convert Gregorian date to Hijri
        function getHijriDate() {
            const today = new Date();
            const options = {
                weekday: 'long',
                day: 'numeric',
                month: 'long',
                year: 'numeric',
                calendar: 'islamic-umalqura'
            };
            return new Intl.DateTimeFormat('en-US', options).format(today);
        }


        async function fetchNamazTimings() {
            const loader = document.getElementById("namaz-loader");
            const errorEl = document.getElementById("namaz-error");
            const cardEl = document.getElementById("namaz-card");
            const container = document.getElementById("namaz-timings-container");
            const dateEl = document.getElementById("namaz-date");

            loader.style.display = "flex";
            errorEl.classList.add("hidden");
            cardEl.classList.add("hidden");

            try {
                const response = await fetch("https://api.aladhan.com/v1/timingsByCity?city=Karachi&country=Pakistan&method=1&school=1");
                if (!response.ok) throw new Error(`Network error: ${response.statusText}`);

                const data = await response.json();
                prayerTimesData = data.data.timings;
                
                // Define fixed and calculated jamaat times
                jamaatTimesData = {
                    Fajr: "05:30",
                    Dhuhr: "13:30",
                    Asr: "17:45",
                    Maghrib: addMinutes(prayerTimesData.Maghrib, 5),
                    Isha: "21:00",
                    Jummah: "13:50"
                };

                // Initialize played statuses
                Object.keys(prayerTimesData).forEach(key => playedStatus[`${key}-Adhan`] = false);
                Object.keys(jamaatTimesData).forEach(key => playedStatus[`${key}-Jamaat`] = false);
                playedStatus['Sunrise-Sunrise'] = false;
                
                const today = new Date();
                const isFriday = today.getDay() === 5; // 5 is Friday
                
                // Use built-in Intl for Hijri date
                const hijriDate = getHijriDate();
                dateEl.textContent = `${today.toDateString()} (${hijriDate})`;

                container.innerHTML = "";

                const prayerDisplayOrder = ["Fajr", "Sunrise", "Dhuhr", "Asr", "Maghrib", "Isha"];
                prayerDisplayOrder.forEach((prayerName) => {
                    const isJummahPrayer = isFriday && prayerName === "Dhuhr";
                    const displayName = isJummahPrayer ? "Jummah" : prayerName;
                    const adhanTime = prayerTimesData[prayerName];
                    const jamaatTime = isJummahPrayer ? jamaatTimesData.Jummah : jamaatTimesData[prayerName];

                    if (adhanTime) {
                        const row = document.createElement("div");
                        row.id = `prayer-row-${prayerName}`;
                        let rowClasses = "flex justify-between items-center p-4 rounded-lg transition-colors duration-300";
                        if (isJummahPrayer) {
                            rowClasses += " bg-green-100 border-l-4 border-green-500";
                        } else {
                            rowClasses += prayerDisplayOrder.indexOf(prayerName) % 2 === 0 ? " bg-green-50" : " bg-white";
                        }
                        row.className = rowClasses;

                        let contentHtml = "";
                        if (prayerName === "Sunrise") {
                            contentHtml = `<p class="text-lg font-semibold text-green-800">${displayName}</p>
                                           <p class="text-xl font-bold text-gray-700">${adhanTime}</p>`;
                        } else {
                            contentHtml = `<p class="text-lg font-semibold text-green-800">${displayName}</p>
                                           <div class="text-right">
                                               <p class="text-sm font-medium text-gray-500">Adhan: <b>${adhanTime}</b></p>
                                               <p class="text-base font-bold text-green-700 mt-1">Jamaat: ${jamaatTime}</p>
                                           </div>`;
                        }
                        row.innerHTML = contentHtml;
                        container.appendChild(row);
                    }
                });

                cardEl.classList.remove("hidden");
                setupEventsAndClock();
            } catch (err) {
                console.error("Error fetching prayer times:", err);
                errorEl.textContent = "Failed to load prayer times. Check your internet connection or try again later.";
                errorEl.classList.remove("hidden");
            } finally {
                loader.style.display = "none";
            }
        }
    </script>
</body>
</html>


