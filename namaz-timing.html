<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jamia Masjid Usman-e-Ghani - Namaz Timing</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: "Inter", sans-serif;
    }

    .nav-link.active {
      background-color: #c2c7c2;
      color: #065f46;
      font-weight: 600;
    }

    .dropdown-item {
      cursor: pointer;
      padding: 0.5rem 1rem;
      display: block;
      font-size: 0.875rem;
      color: #4b5563;
      transition: background-color 0.2s, color 0.2s;
      border-bottom: 1px solid #e5e7eb;
    }

    .dropdown-item:last-child {
      border-bottom: none;
    }

    .dropdown-item:hover {
      background-color: #d1fae5;
      color: #047857;
    }

    .current-prayer-highlight {
      background-color: #ffd700 !important;
      border-left: 4px solid #059669;
      font-weight: bold;
    }

    .next-prayer-highlight {
      background-color: #e6fffa;
    }

    @keyframes blink {
      0% {
        background-color: #1cf36b;
      }

      50% {
        background-color: #d5e7dc;
      }

      100% {
        background-color: #47c776;
      }
    }

    .animate-blink {
      animation: blink 2s infinite;
    }

    /* New CSS for the calendar */
    .calendar-container {
      display: flex;
      justify-content: center;
      gap: 2rem;
      flex-wrap: wrap;
    }

    @media (max-width: 768px) {
      .calendar-container {
        flex-direction: column;
        align-items: center;
      }
    }

    .calendar-box {
      width: 100%;
      max-width: 24rem;
      background-color: #ffffff;
      border-radius: 0.75rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
        0 2px 4px -1px rgba(0, 0, 0, 0.06);
      padding: 1.5rem;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.5rem;
    }

    .calendar-day-header {
      text-align: center;
      font-weight: 500;
      font-size: 0.875rem;
      color: #6b7280;
    }

    .calendar-date {
      text-align: center;
      padding: 0.5rem;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      position: relative;
    }

    .calendar-date.current-month {
      color: #1f2937;
    }

    .calendar-date.other-month {
      color: #d1d5db;
    }

    .calendar-date.today {
      background-color: #d1fae5;
      font-weight: 700;
      border: 1px solid #059669;
    }

    .calendar-date.selected {
      background-color: #059669;
      color: #ffffff;
      font-weight: 700;
    }

    .calendar-date button {
      width: 100%;
      height: 100%;
      display: block;
    }

    .calendar-navigation button {
      background-color: #f3f4f6;
      padding: 0.5rem;
      border-radius: 0.375rem;
      transition: background-color 0.2s;
    }

    .calendar-navigation button:hover {
      background-color: #e5e7eb;
    }
  </style>
</head>

<body class="bg-gray-50">
  <header class="bg-white shadow-md sticky top-0 z-50">
    <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center py-4">
        <div class="text-xl font-bold text-green-700">
          Jamia Masjid Usman-e-Ghani
        </div>
        <div class="hidden md:flex items-center space-x-2">
          <a href="index.html"
            class="nav-link px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200 text-gray-700 hover:bg-green-100 hover:text-green-800">Home</a>
          <a href="namaz-timing.html"
            class="nav-link active px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200 text-gray-700 hover:bg-green-100 hover:text-green-800">Namaz
            Timing</a>
          <a href="members.html"
            class="nav-link px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200 text-gray-700 hover:bg-green-100 hover:text-green-800">Members</a>
          <a href="about.html"
            class="nav-link px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200 text-gray-700 hover:bg-green-100 hover:text-green-800">About</a>
          <div class="relative group">
            <button
              class="nav-link px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200 text-gray-700 hover:bg-green-100 hover:text-green-800">Media</button>
            <div class="absolute hidden group-hover:block w-48 bg-white shadow-lg rounded-md mt-2 py-1 z-10">
              <a href="gallery.html" class="dropdown-item">Gallery</a>
              <a href="tilawat.html" class="dropdown-item active">Tilawat</a>
              <a href="video.html" class="dropdown-item">Video</a>
            </div>
          </div>
          <a href="donation.html"
            class="nav-link px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200 text-gray-700 hover:bg-green-100 hover:text-green-800 animate-blink">Donation</a>
          <a href="contact.html"
            class="nav-link px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200 text-gray-700 hover:bg-green-100 hover:text-green-800">Contact
            Us</a>
        </div>
        <div class="md:hidden">
          <button id="mobile-menu-button" class="text-gray-700 hover:text-green-700 focus:outline-none">
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
            </svg>
          </button>
        </div>
      </div>
      <div id="mobile-menu" class="hidden md:hidden pb-4">
        <a href="index.html"
          class="block nav-link px-4 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-green-100 hover:text-green-800">Home</a>
        <a href="namaz-timing.html"
          class="block nav-link active px-4 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-green-100 hover:text-green-800">Namaz
          Timing</a>
        <a href="members.html"
          class="block nav-link px-4 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-green-100 hover:text-green-800">Members</a>
        <a href="about.html"
          class="block nav-link px-4 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-green-100 hover:text-green-800">About</a>
        <div class="relative">
          <button id="media-mobile-button"
            class="block w-full text-left nav-link px-4 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-green-100 hover:text-green-800">Media</button>
          <div id="media-mobile-dropdown" class="hidden pl-4">
            <a href="gallery.html" class="dropdown-item">Gallery</a>
            <a href="tilawat.html" class="dropdown-item active">Tilawat</a>
            <a href="video.html" class="dropdown-item">Video</a>
          </div>
        </div>
        <a href="donation.html"
          class="block nav-link px-4 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-green-100 hover:text-green-800 animate-blink">Donation</a>
        <a href="contact.html"
          class="block nav-link px-4 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-green-100 hover:text-green-800">Contact
          Us</a>
      </div>
    </nav>
  </header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="text-center mb-8 p-6 bg-white rounded-xl shadow-lg max-w-2xl mx-auto">
      <h2 class="text-4xl font-bold text-gray-800" id="current-time">
        --:--:-- --
      </h2>
      <div id="next-prayer-info" class="mt-4">
        <p class="text-lg font-semibold text-green-800">
          Loading next prayer...
        </p>
        <p id="countdown-timer" class="text-2xl font-bold text-gray-700"></p>
      </div>
      <div id="morning-dua"
        class="hidden mt-4 p-4 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 rounded-md">
        <p class="font-bold">Sunrise Dua:</p>
        <p class="italic">
          "Alhamdu lillahil-ladhi ahyana ba'da ma amatana wa ilayhin-nushur"
        </p>
      </div>
    </div>

        <div class="mt-12">
      <h2 class="text-3xl font-bold text-green-800 text-center mb-6">
        Calendar
      </h2>
      <div class="calendar-container">
                <div class="calendar-box">
          <div class="calendar-header">
            <button id="prev-georgian"
              class="calendar-navigation-button text-gray-500 hover:text-gray-900">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
              </svg>
            </button>
            <h3 class="text-xl font-bold text-gray-800" id="georgian-month-year"></h3>
            <button id="next-georgian"
              class="calendar-navigation-button text-gray-500 hover:text-gray-900">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </button>
          </div>
          <div class="calendar-grid text-green-800">
            <div class="calendar-day-header">Sun</div>
            <div class="calendar-day-header">Mon</div>
            <div class="calendar-day-header">Tue</div>
            <div class="calendar-day-header">Wed</div>
            <div class="calendar-day-header">Thu</div>
            <div class="calendar-day-header">Fri</div>
            <div class="calendar-day-header">Sat</div>
            <div id="georgian-calendar-body"></div>
          </div>
        </div>

                <div class="calendar-box">
          <div class="calendar-header">
            <button id="prev-hijri"
              class="calendar-navigation-button text-gray-500 hover:text-gray-900">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
              </svg>
            </button>
            <h3 class="text-xl font-bold text-gray-800" id="hijri-month-year"></h3>
            <button id="next-hijri"
              class="calendar-navigation-button text-gray-500 hover:text-gray-900">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </button>
          </div>
          <div class="calendar-grid text-green-800">
            <div class="calendar-day-header">Sun</div>
            <div class="calendar-day-header">Mon</div>
            <div class="calendar-day-header">Tue</div>
            <div class="calendar-day-header">Wed</div>
            <div class="calendar-day-header">Thu</div>
            <div class="calendar-day-header">Fri</div>
            <div class="calendar-day-header">Sat</div>
            <div id="hijri-calendar-body"></div>
          </div>
        </div>
      </div>
    </div>
        <div class="space-y-8 mt-12">
      <div class="text-center">
        <h1 class="text-4xl font-bold text-green-800">Namaz Timings</h1>
        <p id="namaz-date" class="text-gray-600 mt-2">Loading date...</p>
      </div>
      <div id="namaz-loader" class="flex justify-center items-center h-full">
        <div class="w-16 h-16 border-4 border-dashed rounded-full animate-spin border-green-600"></div>
      </div>
      <p id="namaz-error" class="hidden text-center text-red-500 bg-red-100 p-4 rounded-lg"></p>
      <div id="namaz-card" class="hidden bg-white rounded-xl shadow-lg overflow-hidden p-6 md:p-8 max-w-2xl mx-auto">
        <div id="namaz-timings-container" class="space-y-4"></div>
        <div class="mt-6 text-center text-sm text-gray-500">
          <p>Calculation Method: University of Islamic Sciences, Karachi</p>
          <p>Fiqh: Hanafi</p>
          <p>Coordinates: 24.8667° N, 67.05° E</p>
        </div>
      </div>

      <div class="mt-12 max-w-4xl mx-auto">
        <h2 class="text-3xl font-bold text-green-800 text-center mb-6">
          Annual Fixed Jamaat Timetable
        </h2>
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
          <div class="overflow-x-auto">
            <table class="w-full text-sm text-left text-gray-600">
              <thead class="text-xs text-green-800 uppercase bg-green-100">
                <tr>
                  <th scope="col" class="px-6 py-3">Month</th>
                  <th scope="col" class="px-6 py-3 text-center">Fajr</th>
                  <th scope="col" class="px-6 py-3 text-center">Asr</th>
                  <th scope="col" class="px-6 py-3 text-center">Isha</th>
                </tr>
              </thead>
              <tbody>
                <tr class="bg-white border-b">
                  <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                    January
                  </th>
                  <td class="px-6 py-4 text-center">6:30 AM</td>
                  <td class="px-6 py-4 text-center">4:45 PM</td>
                  <td class="px-6 py-4 text-center">8:00 PM</td>
                </tr>
                <tr class="bg-green-50 border-b">
                  <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                    February
                  </th>
                  <td class="px-6 py-4 text-center">6:15 AM</td>
                  <td class="px-6 py-4 text-center">5:00 PM</td>
                  <td class="px-6 py-4 text-center">8:00 PM</td>
                </tr>
                <tr class="bg-white border-b">
                  <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                    March
                  </th>
                  <td class="px-6 py-4 text-center">6:00 AM</td>
                  <td class="px-6 py-4 text-center">5:15 PM</td>
                  <td class="px-6 py-4 text-center">8:15 PM</td>
                </tr>
                <tr class="bg-green-50 border-b">
                  <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                    April
                  </th>
                  <td class="px-6 py-4 text-center">5:45 AM</td>
                  <td class="px-6 py-4 text-center">5:30 PM</td>
                  <td class="px-6 py-4 text-center">8:30 PM</td>
                </tr>
                <tr class="bg-white border-b">
                  <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                    May
                  </th>
                  <td class="px-6 py-4 text-center">5:30 AM</td>
                  <td class="px-6 py-4 text-center">5:45 PM</td>
                  <td class="px-6 py-4 text-center">8:45 PM</td>
                </tr>
                <tr class="bg-green-50 border-b">
                  <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                    June
                  </th>
                  <td class="px-6 py-4 text-center">5:30 AM</td>
                  <td class="px-6 py-4 text-center">5:45 PM</td>
                  <td class="px-6 py-4 text-center">9:00 PM</td>
                </tr>
                <tr class="bg-white border-b">
                  <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                    July
                  </th>
                  <td class="px-6 py-4 text-center">5:30 AM</td>
                  <td class="px-6 py-4 text-center">5:45 PM</td>
                  <td class="px-6 py-4 text-center">9:00 PM</td>
                </tr>
                <tr class="bg-green-50 border-b">
                  <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                    August
                  </th>
                  <td class="px-6 py-4 text-center">5:45 AM</td>
                  <td class="px-6 py-4 text-center">5:30 PM</td>
                  <td class="px-6 py-4 text-center">8:45 PM</td>
                </tr>
                <tr class="bg-white border-b">
                  <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                    September
                  </th>
                  <td class="px-6 py-4 text-center">6:00 AM</td>
                  <td class="px-6 py-4 text-center">5:15 PM</td>
                  <td class="px-6 py-4 text-center">8:15 PM</td>
                </tr>
                <tr class="bg-green-50 border-b">
                  <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                    October
                  </th>
                  <td class="px-6 py-4 text-center">6:15 AM</td>
                  <td class="px-6 py-4 text-center">5:00 PM</td>
                  <td class="px-6 py-4 text-center">8:00 PM</td>
                </tr>
                <tr class="bg-white border-b">
                  <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                    November
                  </th>
                  <td class="px-6 py-4 text-center">6:30 AM</td>
                  <td class="px-6 py-4 text-center">4:45 PM</td>
                  <td class="px-6 py-4 text-center">7:45 PM</td>
                </tr>
                <tr class="bg-green-50">
                  <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                    December
                  </th>
                  <td class="px-6 py-4 text-center">6:45 AM</td>
                  <td class="px-6 py-4 text-center">4:30 PM</td>
                  <td class="px-6 py-4 text-center">7:45 PM</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="p-4 text-center text-sm text-gray-500 bg-gray-50">
            <p>
              <strong>Note:</strong> Dhuhr (1:30 PM), Jummah (1:50 PM), and
              Maghrib (5 mins after Adhan) times are fixed year-round. This
              table shows monthly changes for other prayers.
            </p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <div id="audio-permission-banner"
    class="fixed bottom-0 left-0 right-0 bg-blue-100 border-t border-blue-200 p-3 text-center text-blue-800 z-50 flex justify-between items-center">
    <span>Click anywhere on the page to enable Azan & Iqamah audio
      notifications.</span>
    <button id="close-banner-btn" class="text-blue-800 font-bold text-xl px-2">
      &times;
    </button>
  </div>

  <footer class="bg-gray-800 text-white mt-12">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6 text-center">
      <p>
        © <span id="year"></span> Jamia Masjid Usman-e-Ghani. All Rights
        Reserved.
      </p>
      <p class="text-sm text-gray-400 mt-1">
        ST-11, Sector 5-A/1, North Karachi, Karachi
      </p>
    </div>
  </footer>

  <audio id="azan-audio" preload="auto" src="azan.aac"></audio>
  <audio id="iqamah-audio" preload="auto" src="Iqamat.mp3"></audio>

  <script>
    let clockInterval = null;
    let prayerTimesData = {};
    let jamaatTimesData = {};
    let playedStatus = {};
    let jamaatPlayedStatus = {};
    let allEvents = [];

    // New: Calendar state variables
    let currentGeorgianDate = new Date();
    let currentHijriMonth = 1;
    let currentHijriYear = 1445; // Based on current Hijri year

    // New: Function to convert Gregorian to Hijri
    function gregorianToHijri(date) {
      const year = date.getFullYear();
      const month = date.getMonth() + 1;
      const day = date.getDate();
      // This is a simplified conversion, for a more accurate one, a library or API is needed.
      // The conversion logic below is a basic approximation for demonstration.
      // Using an external API for accuracy is highly recommended.
      const h = new Intl.DateTimeFormat('en-US-u-ca-islamic', {
        day: 'numeric',
        month: 'long',
        year: 'numeric'
      }).format(date);
      const parts = h.split(' ');
      return { day: parseInt(parts[1]), month: parts[0], year: parseInt(parts[2]) };
    }

    // New: Function to convert Hijri to Gregorian
    // This is complex and best handled by an API. Let's make a dummy function for now.
    function hijriToGeorgian(year, month, day) {
      // This is a placeholder and not an accurate conversion.
      // Real-world applications should use a robust library or API.
      return new Date(
        new Date().getFullYear(),
        new Date().getMonth(),
        new Date().getDate()
      );
    }


    // New: Function to render the Georgian calendar
    function renderGeorgianCalendar(date) {
      const year = date.getFullYear();
      const month = date.getMonth();
      const today = new Date();
      const firstDayOfMonth = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const lastDayOfPrevMonth = new Date(year, month, 0).getDate();
      const monthNames = [
        "January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"
      ];
      const monthYearEl = document.getElementById("georgian-month-year");
      const bodyEl = document.getElementById("georgian-calendar-body");
      bodyEl.innerHTML = "";
      monthYearEl.textContent = `${monthNames[month]} ${year}`;

      // Fill in days from previous month
      for (let i = 0; i < firstDayOfMonth; i++) {
        const day = lastDayOfPrevMonth - firstDayOfMonth + i + 1;
        const dayEl = document.createElement("div");
        dayEl.className = "calendar-date other-month";
        dayEl.textContent = day;
        bodyEl.appendChild(dayEl);
      }

      // Fill in days of current month
      for (let i = 1; i <= daysInMonth; i++) {
        const dayEl = document.createElement("div");
        dayEl.className = "calendar-date current-month";
        if (
          i === today.getDate() &&
          month === today.getMonth() &&
          year === today.getFullYear()
        ) {
          dayEl.classList.add("today");
        }
        dayEl.textContent = i;
        bodyEl.appendChild(dayEl);
      }
    }

    // New: Function to render the Hijri calendar
    async function renderHijriCalendar(year, month) {
      const hijriMonthNames = [
        "Muharram", "Safar", "Rabi al-Awwal", "Rabi al-Thani",
        "Jumada al-Awwal", "Jumada al-Thani", "Rajab", "Sha'ban",
        "Ramadan", "Shawwal", "Dhu al-Qi'dah", "Dhu al-Hijjah"
      ];
      const monthYearEl = document.getElementById("hijri-month-year");
      const bodyEl = document.getElementById("hijri-calendar-body");
      bodyEl.innerHTML = "";
      monthYearEl.textContent = `${hijriMonthNames[month - 1]} ${year}`;

      try {
        // Fetch Hijri month data from an API
        const response = await fetch(
          `https://api.aladhan.com/v1/hicriCalendarByCity?city=Karachi&country=Pakistan&month=${month}&year=${year}`
        );
        if (!response.ok) throw new Error("Could not fetch Hijri calendar data.");
        const data = await response.json();
        const days = data.data;

        // Find the starting day of the week
        const firstDay = days[0].date.gregorian.weekday.en;
        const dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        const firstDayIndex = dayNames.indexOf(firstDay);

        // Fill in empty days at the start of the grid
        for (let i = 0; i < firstDayIndex; i++) {
          const dayEl = document.createElement("div");
          dayEl.className = "calendar-date other-month";
          bodyEl.appendChild(dayEl);
        }

        // Fill in Hijri days
        days.forEach((dayData) => {
          const dayEl = document.createElement("div");
          dayEl.className = "calendar-date current-month";
          if (dayData.date.gregorian.date === new Date().toISOString().slice(0, 10)) {
            dayEl.classList.add("today");
          }
          dayEl.innerHTML = `<span>${dayData.date.hijri.day}</span>`;
          bodyEl.appendChild(dayEl);
        });

      } catch (err) {
        console.error("Error fetching Hijri calendar:", err);
        bodyEl.innerHTML = `<div class="col-span-7 text-center text-red-500">Failed to load Hijri calendar.</div>`;
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      const mobileMenuButton = document.getElementById("mobile-menu-button");
      const mobileMenu = document.getElementById("mobile-menu");
      mobileMenuButton.addEventListener("click", () => {
        mobileMenu.classList.toggle("hidden");
      });

      document.getElementById("year").textContent = new Date().getFullYear();
      fetchNamazTimings();
      
      // New: Render calendars on page load
      renderGeorgianCalendar(currentGeorgianDate);
      renderHijriCalendar(currentHijriYear, currentHijriMonth);

      // New: Add event listeners for calendar navigation
      document.getElementById("prev-georgian").addEventListener("click", () => {
        currentGeorgianDate.setMonth(currentGeorgianDate.getMonth() - 1);
        renderGeorgianCalendar(currentGeorgianDate);
      });
      document.getElementById("next-georgian").addEventListener("click", () => {
        currentGeorgianDate.setMonth(currentGeorgianDate.getMonth() + 1);
        renderGeorgianCalendar(currentGeorgianDate);
      });
      document.getElementById("prev-hijri").addEventListener("click", () => {
        currentHijriMonth--;
        if (currentHijriMonth < 1) {
          currentHijriMonth = 12;
          currentHijriYear--;
        }
        renderHijriCalendar(currentHijriYear, currentHijriMonth);
      });
      document.getElementById("next-hijri").addEventListener("click", () => {
        currentHijriMonth++;
        if (currentHijriMonth > 12) {
          currentHijriMonth = 1;
          currentHijriYear++;
        }
        renderHijriCalendar(currentHijriYear, currentHijriMonth);
      });

      const audioBanner = document.getElementById("audio-permission-banner");
      const closeBannerBtn = document.getElementById("close-banner-btn");

      function enableAudio() {
        const azanAudio = document.getElementById("azan-audio");
        const iqamahAudio = document.getElementById("iqamah-audio");

        azanAudio.muted = true;
        azanAudio.play().catch(() => {});
        azanAudio.pause();
        azanAudio.currentTime = 0;
        azanAudio.muted = false;

        iqamahAudio.muted = true;
        iqamahAudio.play().catch(() => {});
        iqamahAudio.pause();
        iqamahAudio.currentTime = 0;
        iqamahAudio.muted = false;

        audioBanner.style.display = "none";
        document.body.removeEventListener("click", enableAudio);
      }

      document.body.addEventListener("click", enableAudio, { once: true });
      closeBannerBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        audioBanner.style.display = "none";
      });
    });

    function addMinutes(timeStr, minsToAdd) {
      const [hours, minutes] = timeStr.split(":").map(Number);
      const date = new Date();
      date.setHours(hours, minutes + minsToAdd, 0, 0);
      const newHours = String(date.getHours()).padStart(2, "0");
      const newMinutes = String(date.getMinutes()).padStart(2, "0");
      return `${newHours}:${newMinutes}`;
    }

    function timeToSeconds(time) {
      if (!time) return 0;
      const [hours, minutes] = time.split(":").map(Number);
      return hours * 3600 + minutes * 60;
    }

    function setupEventsAndClock() {
      allEvents = [];
      const adhanPrayers = ["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"];

      adhanPrayers.forEach((name) => {
        if (prayerTimesData[name]) {
          allEvents.push({
            name: name,
            time: prayerTimesData[name],
            type: "Adhan",
          });
        }
      });

      Object.keys(jamaatTimesData).forEach((name) => {
        if (jamaatTimesData[name]) {
          const eventName = name === "Jummah" ? "Jummah" : name;
          allEvents.push({
            name: eventName,
            time: jamaatTimesData[name],
            type: "Jamaat",
          });
        }
      });

      if (prayerTimesData.Sunrise) {
        allEvents.push({
          name: "Sunrise",
          time: prayerTimesData.Sunrise,
          type: "Sunrise",
        });
      }

      allEvents.sort((a, b) => timeToSeconds(a.time) - timeToSeconds(b.time));

      runClockAndChecks();
    }

    function runClockAndChecks() {
      if (clockInterval) clearInterval(clockInterval);

      clockInterval = setInterval(() => {
        const now = new Date();
        document.getElementById("current-time").textContent =
          now.toLocaleTimeString("en-US");
        const nowInSeconds =
          now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();

        const prayerOrderForHighlight = [
          "Fajr",
          "Sunrise",
          "Dhuhr",
          "Asr",
          "Maghrib",
          "Isha",
        ];
        let nextPrayerNameForHighlight = "Fajr";
        let foundNextHighlight = false;
        let currentPrayerNameForHighlight = "";

        document
          .querySelectorAll("[id^=prayer-row-]")
          .forEach((row) =>
            row.classList.remove(
              "current-prayer-highlight",
              "next-prayer-highlight"
            )
          );

        for (let i = 0; i < prayerOrderForHighlight.length; i++) {
          const prayerName = prayerOrderForHighlight[i];
          if (timeToSeconds(prayerTimesData[prayerName]) > nowInSeconds) {
            nextPrayerNameForHighlight = prayerName;
            foundNextHighlight = true;
            if (i > 0)
              currentPrayerNameForHighlight = prayerOrderForHighlight[i - 1];
            break;
          }
        }
        if (!foundNextHighlight) currentPrayerNameForHighlight = "Isha";

        if (currentPrayerNameForHighlight)
          document
            .getElementById(`prayer-row-${currentPrayerNameForHighlight}`)
            ?.classList.add("current-prayer-highlight");
        if (foundNextHighlight)
          document
            .getElementById(`prayer-row-${nextPrayerNameForHighlight}`)
            ?.classList.add("next-prayer-highlight");

        let nextEvent = null;
        let foundNextEvent = false;

        for (const event of allEvents) {
          if (timeToSeconds(event.time) > nowInSeconds) {
            nextEvent = event;
            foundNextEvent = true;
            break;
          }
        }

        if (!foundNextEvent) nextEvent = allEvents[0];

        let timeToNextEventInSeconds;
        if (foundNextEvent) {
          timeToNextEventInSeconds =
            timeToSeconds(nextEvent.time) - nowInSeconds;
        } else {
          timeToNextEventInSeconds =
            24 * 3600 - nowInSeconds + timeToSeconds(nextEvent.time);
        }

        const hours = Math.floor(timeToNextEventInSeconds / 3600);
        const minutes = Math.floor((timeToNextEventInSeconds % 3600) / 60);
        const seconds = timeToNextEventInSeconds % 60;

        const eventDisplayName =
          nextEvent.type === "Jamaat"
            ? `${nextEvent.name} Jamaat`
            : `${nextEvent.name}`;
        document.querySelector(
          "#next-prayer-info p:first-child"
        ).textContent = `Time until ${eventDisplayName}:`;
        document.getElementById("countdown-timer").textContent = `${String(
          hours
        ).padStart(2, "0")}h ${String(minutes).padStart(2, "0")}m ${String(
          seconds
        ).padStart(2, "0")}s`;

        if (timeToNextEventInSeconds <= 1) {
          if (nextEvent.type === "Adhan" && !playedStatus[nextEvent.name]) {
            console.log(`Time for ${nextEvent.name} Adhan! Playing Azan.`);
            document
              .getElementById("azan-audio")
              .play()
              .catch((e) => console.error("Azan audio play failed:", e));
            playedStatus[nextEvent.name] = true;
          } else if (
            nextEvent.type === "Jamaat" &&
            !jamaatPlayedStatus[nextEvent.name]
          ) {
            console.log(`Time for ${nextEvent.name} Jamaat! Playing Iqamah.`);
            document
              .getElementById("iqamah-audio")
              .play()
              .catch((e) => console.error("Iqamah audio play failed:", e));
            jamaatPlayedStatus[nextEvent.name] = true;

            if (nextEvent.name === "Isha") {
              setTimeout(() => {
                Object.keys(playedStatus).forEach(
                  (key) => (playedStatus[key] = false)
                );
                Object.keys(jamaatPlayedStatus).forEach(
                  (key) => (jamaatPlayedStatus[key] = false)
                );
                console.log("All prayer statuses reset for the next day.");
              }, 5000);
            }
          } else if (
            nextEvent.type === "Sunrise" &&
            !playedStatus[nextEvent.name]
          ) {
            console.log("Time for Sunrise Dua.");
            document.getElementById("morning-dua").classList.remove("hidden");
            setTimeout(
              () =>
                document
                  .getElementById("morning-dua")
                  .classList.add("hidden"),
              5 * 60 * 1000
            );
            playedStatus[nextEvent.name] = true;
          }
        }
      }, 1000);
    }

    async function fetchNamazTimings() {
      const loader = document.getElementById("namaz-loader");
      const errorEl = document.getElementById("namaz-error");
      const cardEl = document.getElementById("namaz-card");
      const container = document.getElementById("namaz-timings-container");
      const dateEl = document.getElementById("namaz-date");

      loader.style.display = "flex";
      errorEl.classList.add("hidden");
      cardEl.classList.add("hidden");

      try {
        const response = await fetch(
          "https://api.aladhan.com/v1/timingsByCity?city=Karachi&country=Pakistan&method=1&school=1"
        );
        if (!response.ok)
          throw new Error(`Network error: ${response.statusText}`);

        const data = await response.json();
        const timings = data.data;

        prayerTimesData = timings.timings;

        jamaatTimesData.Fajr = "5:30";
        jamaatTimesData.Dhuhr = "13:30";
        jamaatTimesData.Asr = "17:45";
        jamaatTimesData.Maghrib = addMinutes(timings.timings.Maghrib, 5);
        jamaatTimesData.Isha = "21:00";
        jamaatTimesData.Jummah = "13:50";

        Object.keys(prayerTimesData).forEach(
          (key) => (playedStatus[key] = false)
        );
        Object.keys(jamaatTimesData).forEach(
          (key) => (jamaatPlayedStatus[key] = false)
        );

        const isFriday = new Date(timings.date.readable).getDay() === 5;
        dateEl.textContent = `${timings.date.readable} (${timings.date.hijri.weekday.en}, ${timings.date.hijri.day} ${timings.date.hijri.month.en} ${timings.date.hijri.year})`;
        container.innerHTML = "";

        const prayerDisplayOrder = [
          { name: "Fajr", time: timings.timings.Fajr },
          { name: "Sunrise", time: timings.timings.Sunrise },
          { name: "Dhuhr", time: timings.timings.Dhuhr },
          { name: "Asr", time: timings.timings.Asr },
          { name: "Maghrib", time: timings.timings.Maghrib },
          { name: "Isha", time: timings.timings.Isha },
        ];

        prayerDisplayOrder.forEach((prayer, index) => {
          const isJummahPrayer = isFriday && prayer.name === "Dhuhr";
          const displayName = isJummahPrayer ? "Jummah" : prayer.name;
          const jamaatTime =
            jamaatTimesData[displayName] || jamaatTimesData[prayer.name];

          const row = document.createElement("div");
          row.id = `prayer-row-${prayer.name}`;

          let rowClasses =
            "flex justify-between items-center p-4 rounded-lg transition-colors duration-300";
          if (isJummahPrayer) {
            rowClasses += " bg-green-100 border-l-4 border-green-500";
          } else {
            rowClasses += index % 2 === 0 ? " bg-green-50" : " bg-white";
          }
          row.className = rowClasses;

          const adhanLabel = prayer.name === "Sunrise" ? "Time" : "Adhan";
          row.innerHTML = `
                <p class="text-lg font-semibold text-green-800">${displayName}</p>
                <div class="text-right">
                  <p class="text-xl font-bold text-gray-700">
                    <span class="text-sm font-medium text-gray-500">${adhanLabel}: </span>${prayer.time
            }
                  </p>
                  ${jamaatTime && prayer.name !== "Sunrise"
              ? `<p class="text-base font-bold text-green-700 mt-1">Jamaat: ${jamaatTime}</p>`
              : ""
            }
                </div>`;
          container.appendChild(row);
        });

        cardEl.classList.remove("hidden");
        setupEventsAndClock();
      } catch (err) {
        console.error("Error fetching prayer times:", err);
        errorEl.textContent =
          "Failed to load prayer times. Check your internet connection.";
        errorEl.classList.remove("hidden");
      } finally {
        loader.style.display = "none";
      }
    }
  </script>
<script>
    document.getElementById("year").textContent = new Date().getFullYear();
    const mobileMenuButton = document.getElementById("mobile-menu-button");
    const mobileMenu = document.getElementById("mobile-menu");
    mobileMenuButton.addEventListener("click", () => {
      mobileMenu.classList.toggle("hidden");
    });

    const mediaMobileButton = document.getElementById("media-mobile-button");
    const mediaMobileDropdown = document.getElementById("media-mobile-dropdown");
    mediaMobileButton.addEventListener("click", () => {
      mediaMobileDropdown.classList.toggle("hidden");
    });
  </script>
</body>

</html>
